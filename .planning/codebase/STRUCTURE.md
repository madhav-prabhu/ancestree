# Codebase Structure

**Analysis Date:** 2026-01-26

## Directory Layout

```
ancestree/
├── src/                           # Main application source
│   ├── App.tsx                    # Main app component, state orchestration
│   ├── Router.tsx                 # React Router setup
│   ├── main.tsx                   # Application entry point
│   ├── vite-env.d.ts             # Vite type definitions
│   ├── components/                # React UI components
│   ├── hooks/                     # Custom React hooks
│   ├── models/                    # TypeScript types and data structures
│   ├── pages/                     # Page components (routes)
│   ├── scene/                     # 3D visualization (Three.js)
│   ├── services/                  # Business logic and data access
│   ├── utils/                     # Utility functions
│   ├── schemas/                   # Data validation schemas
│   └── test/                      # Test utilities and setup
├── public/                        # Static assets
├── dist/                          # Production build output
├── node_modules/                  # Dependencies (generated)
├── .planning/                     # GSD planning documents
├── .claude/                       # Agent system configuration
├── docs/                          # Project documentation
├── package.json                   # Dependencies and build scripts
├── tsconfig.json                  # TypeScript configuration
├── vite.config.ts                 # Vite bundler configuration
├── vitest.config.ts               # Test framework configuration
├── tailwind.config.ts             # Tailwind CSS configuration
└── CLAUDE.md                      # Project instructions for Claude

```

## Directory Purposes

**src/:**
- Purpose: All application source code
- Contains: TypeScript/TSX files organized by layer (components, services, models, scene)

**src/components/:**
- Purpose: React UI components for user interface
- Contains: Modal dialogs (AddMemberModal, EditMemberModal, AddRelationshipModal), sidebar (MemberListSidebar), detail panel (MemberDetailPanel), layout system (Layout.tsx with Header, SaveIndicator, EmptyState)
- Key files: `Layout.tsx` (main layout structure), `index.ts` (barrel export)

**src/hooks/:**
- Purpose: Custom React hooks for state management and data access
- Contains: `useFamilyData.ts` (data management hook with loading/error states)
- Pattern: Hooks wrap service layer, provide reactive state to components

**src/models/:**
- Purpose: TypeScript interfaces and type definitions
- Contains: `FamilyMember` (person entity), `Relationship` (connection entity), helper constructors
- Key files: `index.ts` (barrel export)

**src/pages/:**
- Purpose: Page components mounted by Router
- Contains: `TimelinePage.tsx` (alternative chronological view)
- Follows pattern: Each route gets a dedicated page component

**src/scene/:**
- Purpose: 3D visualization using Three.js and react-three-fiber
- Contains: TreeScene (main canvas), CameraController, galaxy components (3D node rendering), layout algorithms, MiniMap
- Subdirectory `galaxy/`: Cosmic visualization components (GalaxyNode, EtherealConnections, CosmicBackground, PhysicsContext)
- Subdirectory `layout/`: Positional layout algorithms (treeLayout.ts)

**src/services/:**
- Purpose: Business logic layer and data persistence abstraction
- Contains: `familyService.ts` (core logic), `storage/` (persistence backend)
- Subdirectory `storage/`: StorageInterface (contract), DexieStorage (IndexedDB implementation)

**src/utils/:**
- Purpose: Utility and helper functions
- Contains: Export/import utilities, date parsing, image handling

**src/schemas/:**
- Purpose: Data validation schemas
- Contains: Validation rules for input data (likely Zod or similar)

**src/test/:**
- Purpose: Test utilities and setup
- Contains: Vitest setup configuration, test helpers

**public/:**
- Purpose: Static assets served as-is
- Contains: index.html, favicon, any static images

**dist/:**
- Purpose: Production build output
- Generated by: `npm run build`
- Contains: Bundled JS, CSS, optimized assets

## Key File Locations

**Entry Points:**
- `src/main.tsx`: Mounts React app at #root
- `src/Router.tsx`: Defines routes and page mapping
- `src/App.tsx`: Main application component (route `/`)
- `src/pages/TimelinePage.tsx`: Timeline page (route `/timeline`)

**Configuration:**
- `package.json`: Dependencies, build scripts, project metadata
- `tsconfig.json`: TypeScript compiler options
- `vite.config.ts`: Build tool configuration (dev server, HMR)
- `vitest.config.ts`: Test runner setup
- `tailwind.config.ts`: Styling framework configuration
- `CLAUDE.md`: Instructions for AI agents working in this codebase

**Core Logic:**
- `src/models/FamilyMember.ts`: Person entity definition
- `src/models/Relationship.ts`: Relationship entity definition
- `src/services/familyService.ts`: All business logic (validation, CRUD, queries)
- `src/services/storage/StorageInterface.ts`: Storage contract
- `src/services/storage/DexieStorage.ts`: IndexedDB implementation
- `src/hooks/useFamilyData.ts`: React state wrapper for familyService

**UI Components:**
- `src/components/Layout.tsx`: Page layout structure (header, sidebar, detail panel)
- `src/components/AddMemberModal.tsx`: Form modal for creating members
- `src/components/EditMemberModal.tsx`: Form modal for updating members
- `src/components/AddRelationshipModal.tsx`: Form modal for relationships
- `src/components/MemberListSidebar.tsx`: Left sidebar member list
- `src/components/MemberDetailPanel.tsx`: Right panel with member details and relationships

**3D Visualization:**
- `src/scene/TreeScene.tsx`: Main Canvas component, orchestrates 3D rendering
- `src/scene/CameraController.tsx`: Camera positioning and animation
- `src/scene/galaxy/GalaxyNode.tsx`: Individual 3D node for family member
- `src/scene/galaxy/EtherealConnection.tsx`: Connection lines between members
- `src/scene/galaxy/CosmicBackground.tsx`: Starfield background
- `src/scene/galaxy/PhysicsContext.tsx`: Spring physics simulation context
- `src/scene/layout/treeLayout.ts`: Algorithm for calculating 3D member positions
- `src/scene/MiniMap.tsx`: Overview map of tree in corner

**Utilities:**
- `src/utils/exportUtils.ts`: JSON export to file download
- `src/utils/importUtils.ts`: JSON import from file upload
- `src/utils/dateUtils.ts`: Date parsing and formatting
- `src/utils/imageUtils.ts`: Image handling for member photos

**Testing:**
- `src/components/__tests__/`: Test files for UI components
- `src/services/__tests__/`: Tests for business logic
- `src/models/FamilyMember.test.ts`: Tests for FamilyMember validation
- `src/hooks/__tests__/useFamilyData.test.ts`: Tests for state hook

## Naming Conventions

**Files:**
- Components: `PascalCase.tsx` (e.g., `AddMemberModal.tsx`)
- Services: `camelCase.ts` (e.g., `familyService.ts`)
- Utilities: `camelCase.ts` (e.g., `dateUtils.ts`)
- Types/Models: `PascalCase.ts` (e.g., `FamilyMember.ts`)
- Tests: `{original-name}.test.ts` or `__tests__/{original-name}.test.ts`

**Directories:**
- Feature directories: lowercase (e.g., `components/`, `services/`, `models/`)
- Subdirectories: lowercase with descriptive names (e.g., `src/services/storage/`)

**Functions/Variables:**
- camelCase for functions and variables
- UPPER_CASE for constants (e.g., `DEFAULT_CONFIG`, `EXPORT_VERSION`)
- PascalCase for types, interfaces, classes

**Exports:**
- Barrel files named `index.ts` re-export public API from directory
- Example: `src/components/index.ts` exports all component names

## Where to Add New Code

**New Feature (e.g., Photos feature):**
1. **Data layer**: Add fields to `FamilyMember` in `src/models/FamilyMember.ts`
2. **Validation**: Add validation in `src/services/familyService.ts` (validateMemberDates pattern)
3. **Storage**: Storage interface automatically supports new fields (generic object support)
4. **Hook**: No changes needed—useFamilyData uses familyService dynamically
5. **UI**: Add form fields to `src/components/AddMemberModal.tsx` and `EditMemberModal.tsx`
6. **Tests**: Add tests in `src/components/__tests__/{ComponentName}.test.tsx`

**New Component/Module:**
1. Create file in `src/components/{FeatureName}.tsx` (or appropriate subdirectory)
2. Export from `src/components/index.ts`
3. Use hooks from `src/hooks/` to access data
4. Add tests in `src/components/__tests__/{FeatureName}.test.tsx`

**New 3D Visualization Element:**
1. Create file in `src/scene/` or `src/scene/galaxy/`
2. Use Three.js/react-three-fiber patterns (Canvas, useFrame, useThree)
3. Access positions/relationships from TreeScene props
4. Export from `src/scene/index.ts` if needed
5. Integrate into TreeScene.tsx Canvas content

**New Page/Route:**
1. Create file in `src/pages/{PageName}.tsx`
2. Add route to `src/Router.tsx`
3. Use useFamilyData for data access (same as App.tsx)

**Utilities:**
1. Create file in `src/utils/{featureName}Utils.ts`
2. Export functions from the utility file
3. Import in components/services as needed

**Business Logic:**
1. Add methods to `src/services/familyService.ts` (don't create new service files—keep logic centralized)
2. Add convenience methods following pattern: getX, addX, deleteX
3. Include validation in add/update methods

## Special Directories

**src/services/storage/:**
- Purpose: Storage backend abstraction
- Generated: No (hand-written)
- Committed: Yes
- Note: Current implementation is DexieStorage (IndexedDB). To swap backends, change export in `src/services/storage/index.ts`

**src/scene/galaxy/:**
- Purpose: 3D component library for cosmic visualization
- Generated: No
- Committed: Yes
- Note: Contains physics simulation context and cosmic visual components

**src/scene/layout/:**
- Purpose: Graph layout algorithms
- Generated: No
- Committed: Yes
- Note: Tree positioning algorithm—modify here to change family tree visual layout

**src/components/__tests__/ and src/services/__tests__/:**
- Purpose: Test files for components and services
- Generated: No (hand-written)
- Committed: Yes
- Pattern: One test file per component/service

**public/:**
- Purpose: Static assets
- Generated: No
- Committed: Yes
- Note: index.html entry point served by Vite dev server

**dist/:**
- Purpose: Production build
- Generated: Yes (by `npm run build`)
- Committed: No (.gitignored)

---

*Structure analysis: 2026-01-26*
