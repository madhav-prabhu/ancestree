---
phase: 02-file-operations-menus
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - electron/main/menu.ts
  - electron/main/index.ts
autonomous: true

must_haves:
  truths:
    - "macOS shows Ancestree in menu bar with About, Hide, Quit"
    - "File menu has New, Open, Save, Save As, Export, Quit items"
    - "Edit menu has Undo, Redo, Cut, Copy, Paste, Select All"
    - "Cmd/Ctrl+S, Cmd/Ctrl+O, Cmd/Ctrl+N work as accelerators"
    - "View menu has zoom controls and fullscreen toggle"
    - "Help menu has About, Documentation, Report Issue"
  artifacts:
    - path: "electron/main/menu.ts"
      provides: "Application menu template"
      exports: ["createApplicationMenu"]
    - path: "electron/main/index.ts"
      provides: "Menu setup on app ready"
      contains: "createApplicationMenu"
  key_links:
    - from: "electron/main/index.ts"
      to: "electron/main/menu.ts"
      via: "createApplicationMenu() call after window creation"
      pattern: "createApplicationMenu\\(mainWindow\\)"
    - from: "electron/main/menu.ts"
      to: "mainWindow.webContents"
      via: "webContents.send for menu actions"
      pattern: "webContents\\.send\\('menu:"
---

<objective>
Create cross-platform application menu with keyboard shortcuts and proper macOS app menu.

Purpose: Give users standard desktop app navigation with File, Edit, View, Help menus. Menu actions send IPC events to renderer for handling file operations.

Output:
- `electron/main/menu.ts` with complete menu template
- Menu integrated into main process initialization
</objective>

<execution_context>
@/home/madhav/.claude/get-shit-done/workflows/execute-plan.md
@/home/madhav/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-file-operations-menus/02-RESEARCH.md
@.planning/phases/02-file-operations-menus/02-CONTEXT.md

# Existing main process to extend
@electron/main/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Application Menu Module</name>
  <files>electron/main/menu.ts</files>
  <action>
Create `electron/main/menu.ts` with a `createApplicationMenu(mainWindow: BrowserWindow)` function.

Use `Menu.buildFromTemplate()` with the following structure:

**1. macOS App Menu (first item, only on darwin):**
```typescript
const isMac = process.platform === 'darwin'

...(isMac ? [{
  label: app.name,  // "Ancestree"
  submenu: [
    { role: 'about' },
    { type: 'separator' },
    { role: 'services' },
    { type: 'separator' },
    { role: 'hide' },
    { role: 'hideOthers' },
    { role: 'unhide' },
    { type: 'separator' },
    { role: 'quit' }
  ]
}] : [])
```

**2. File Menu:**
- New (Cmd/Ctrl+N) -> `mainWindow.webContents.send('menu:new')`
- Open (Cmd/Ctrl+O) -> `mainWindow.webContents.send('menu:open')`
- separator
- Save (Cmd/Ctrl+S) -> `mainWindow.webContents.send('menu:save')`
- Save As (Cmd/Ctrl+Shift+S) -> `mainWindow.webContents.send('menu:saveAs')`
- separator
- Export... -> `mainWindow.webContents.send('menu:export')`
- separator
- On macOS: `{ role: 'close' }`, on Windows/Linux: `{ role: 'quit' }`

**3. Edit Menu (use built-in roles):**
- `{ role: 'undo' }`
- `{ role: 'redo' }`
- separator
- `{ role: 'cut' }`
- `{ role: 'copy' }`
- `{ role: 'paste' }`
- `{ role: 'selectAll' }`

**4. View Menu:**
- `{ role: 'reload' }` (dev only or always for debugging)
- `{ role: 'forceReload' }` (dev only)
- separator
- `{ role: 'resetZoom' }`
- `{ role: 'zoomIn' }`
- `{ role: 'zoomOut' }`
- separator
- `{ role: 'togglefullscreen' }`

**5. Help Menu:**
- About Ancestree (on Windows/Linux only, macOS uses app menu About)
  - On non-Mac: show simple dialog with `dialog.showMessageBox()`
- separator
- Documentation -> `shell.openExternal('https://ancestree.app/docs')` (placeholder URL)
- Visit Website -> `shell.openExternal('https://ancestree.app')` (placeholder URL)
- Report Issue -> `shell.openExternal('https://github.com/ancestree/issues')` (placeholder URL)

Use `accelerator: 'CommandOrControl+Key'` for cross-platform shortcuts.

After building template, call `Menu.setApplicationMenu(menu)`.
  </action>
  <verify>
File exists at `electron/main/menu.ts`.
Exports `createApplicationMenu` function.
Template includes all 5 menu sections (App on macOS, File, Edit, View, Help).
  </verify>
  <done>
Complete application menu template with all required items.
Cross-platform accelerators using CommandOrControl.
macOS app menu with standard roles.
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate Menu into Main Process</name>
  <files>electron/main/index.ts</files>
  <action>
Update `electron/main/index.ts`:

1. Add import at top:
   ```typescript
   import { createApplicationMenu } from './menu'
   ```

2. In `app.whenReady()`, after `createWindow()` is called:
   ```typescript
   app.whenReady().then(() => {
     createWindow()

     // Set up application menu (after window exists)
     if (mainWindow) {
       createApplicationMenu(mainWindow)
     }

     // ... rest of existing code
   })
   ```

Note: Menu needs the mainWindow reference to send IPC events. The menu is global but uses the main window for webContents.send().
  </action>
  <verify>
`npm run build` passes.
`electron/main/index.ts` imports and calls `createApplicationMenu`.
  </verify>
  <done>
Application menu integrated into app startup.
Menu appears when app launches.
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify Menu Functionality</name>
  <files>None (verification only)</files>
  <action>
Run the app and verify all menus work:

1. `npm run dev`

2. **macOS verification** (if on macOS):
   - Check "Ancestree" appears in menu bar (left of File)
   - Ancestree menu has: About, Services, Hide, Quit
   - Cmd+Q quits the app
   - Cmd+H hides the app

3. **File menu verification:**
   - File menu visible with all items: New, Open, Save, Save As, Export, Quit/Close
   - Check accelerators shown: Cmd/Ctrl+N, Cmd/Ctrl+O, Cmd/Ctrl+S, Cmd/Ctrl+Shift+S
   - Press Cmd/Ctrl+N - should work (even if handler not wired yet)

4. **Edit menu verification:**
   - All standard edit items present: Undo, Redo, Cut, Copy, Paste, Select All
   - Accelerators work (Cmd/Ctrl+Z for undo, etc.)

5. **View menu verification:**
   - Zoom controls present and work
   - Fullscreen toggle works (F11 or Ctrl+Cmd+F on macOS)

6. **Help menu verification:**
   - Documentation/Website/Report Issue open external browser
   - About shows dialog (Windows/Linux) or uses system About (macOS)

7. **DevTools test for menu events:**
   - Open DevTools console
   - Set up listener: `window.electronAPI.onMenuAction(action => console.log('Menu:', action))`
   - Click File > New, File > Open, etc.
   - Console should show: "Menu: new", "Menu: open", etc.
  </action>
  <verify>
All menus visible and accessible.
Keyboard shortcuts work.
Menu events reach renderer (logged in DevTools).
External links open in system browser.
  </verify>
  <done>
Application menu fully functional on all platforms.
Menu events sent to renderer via IPC.
Standard accelerators working.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` passes without errors
2. `npm run dev` shows application menu
3. macOS: "Ancestree" app menu appears with standard items
4. File menu has all required items with correct accelerators
5. Edit menu roles work (cut/copy/paste functional in text fields)
6. Help menu external links open in browser
7. Menu events logged in DevTools console
</verification>

<success_criteria>
- Application menu appears on all platforms
- macOS shows "Ancestree" as app name in menu bar
- All keyboard shortcuts work (Cmd/Ctrl+S/O/N/Q)
- Menu events sent to renderer via webContents.send
- External links open in system browser
</success_criteria>

<output>
After completion, create `.planning/phases/02-file-operations-menus/02-02-SUMMARY.md`
</output>
