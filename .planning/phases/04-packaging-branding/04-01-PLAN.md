---
phase: 04-packaging-branding
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - assets/icon-source.png
  - build/icon.icns
  - build/icon.ico
  - build/icon.png
  - build/icons/16x16.png
  - build/icons/32x32.png
  - build/icons/48x48.png
  - build/icons/64x64.png
  - build/icons/128x128.png
  - build/icons/256x256.png
  - build/icons/512x512.png
  - electron-builder.yml
  - package.json
autonomous: true

must_haves:
  truths:
    - "App shows custom Ancestree icon in dock/taskbar (not default Electron icon)"
    - "electron-builder can locate icon files for all platforms"
  artifacts:
    - path: "assets/icon-source.png"
      provides: "Source icon for generation"
      min_lines: 0
    - path: "build/icon.icns"
      provides: "macOS application icon"
    - path: "build/icon.ico"
      provides: "Windows application icon"
    - path: "build/icon.png"
      provides: "Linux/fallback icon"
    - path: "electron-builder.yml"
      provides: "Packaging configuration"
      contains: "appId: com.ancestree.app"
  key_links:
    - from: "electron-builder.yml"
      to: "build/icon.*"
      via: "icon path configuration"
      pattern: "icon: build/icon"
    - from: "package.json"
      to: "electron-builder"
      via: "build scripts"
      pattern: "electron-builder"
---

<objective>
Create application icons and electron-builder configuration for cross-platform packaging.

Purpose: Establish branding assets and build infrastructure so Ancestree can be packaged as a professional desktop application with custom icons on all platforms.

Output: Icon files in all required formats (icns, ico, png sizes), electron-builder.yml configuration, and npm build scripts.
</objective>

<execution_context>
@/home/madhav/.claude/get-shit-done/workflows/execute-plan.md
@/home/madhav/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-packaging-branding/04-RESEARCH.md
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create source icon and generate all formats</name>
  <files>
    assets/icon-source.png
    build/icon.icns
    build/icon.ico
    build/icon.png
    build/icons/*.png
    package.json
  </files>
  <action>
1. Create assets/ directory and a placeholder 1024x1024 PNG source icon:
   - Use ImageMagick to create a simple branded icon: green tree silhouette on light background
   - Command: `convert -size 1024x1024 xc:'#f0fdf4' -fill '#166534' -gravity center -pointsize 400 -annotate 0 'A' assets/icon-source.png`
   - This creates a simple "A" for Ancestree as placeholder (user can replace with proper design)

2. Install electron-icon-builder as dev dependency:
   - `npm install -D electron-icon-builder`

3. Add icon generation script to package.json:
   ```json
   "icons": "electron-icon-builder --input=./assets/icon-source.png --output=./build"
   ```

4. Run the icon generation:
   - `npm run icons`
   - This creates build/icons/ directory with all PNG sizes
   - Creates build/icon.icns for macOS
   - Creates build/icon.ico for Windows

5. Copy the 512x512 PNG as build/icon.png for Linux fallback:
   - `cp build/icons/512x512.png build/icon.png`

Note: If ImageMagick is not available, create a simple 1024x1024 PNG using any available method (even a solid color works for testing). The user can replace with a proper icon design later.
  </action>
  <verify>
- `ls -la assets/icon-source.png` shows 1024x1024 PNG exists
- `ls -la build/icon.icns` shows macOS icon exists
- `ls -la build/icon.ico` shows Windows icon exists
- `ls -la build/icons/` shows PNG files at 16, 32, 48, 64, 128, 256, 512 sizes
- `cat package.json | grep '"icons"'` shows the script exists
  </verify>
  <done>Source icon exists at assets/icon-source.png, all platform icon formats generated in build/ directory, icons script added to package.json</done>
</task>

<task type="auto">
  <name>Task 2: Create electron-builder configuration</name>
  <files>
    electron-builder.yml
    package.json
  </files>
  <action>
1. Create electron-builder.yml at project root with full configuration:

```yaml
appId: com.ancestree.app
productName: Ancestree
copyright: Copyright Â© 2026 Ancestree

directories:
  buildResources: build
  output: dist

# Include electron-vite output
files:
  - out/**/*
  - "!**/*.ts"
  - "!**/node_modules/**/*.{md,txt}"

asar: true
asarUnpack:
  - resources/**

# macOS configuration
mac:
  category: public.app-category.lifestyle
  icon: build/icon.icns
  hardenedRuntime: true
  gatekeeperAssess: false
  entitlements: build/entitlements.mac.plist
  entitlementsInherit: build/entitlements.mac.plist
  target:
    - dmg
    - zip

dmg:
  contents:
    - x: 130
      y: 220
    - x: 410
      y: 220
      type: link
      path: /Applications

# Windows configuration
win:
  icon: build/icon.ico
  target:
    - nsis

nsis:
  oneClick: false
  allowToChangeInstallationDirectory: true
  deleteAppDataOnUninstall: false
  createDesktopShortcut: true
  createStartMenuShortcut: true

# Linux configuration
linux:
  icon: build/icons
  category: Utility
  target:
    - AppImage
    - deb

deb:
  depends:
    - libgtk-3-0
    - libnotify4
    - libnss3
    - libxss1
    - libxtst6
    - xdg-utils
    - libatspi2.0-0
    - libuuid1
    - libsecret-1-0

appImage:
  artifactName: ${productName}-${version}.${ext}
```

2. Add platform-specific build scripts to package.json:

```json
"pack": "electron-vite build && electron-builder --config",
"pack:win": "electron-vite build && electron-builder --win --config",
"pack:mac": "electron-vite build && electron-builder --mac --config",
"pack:linux": "electron-vite build && electron-builder --linux --config",
"pack:all": "electron-vite build && electron-builder -mwl --config"
```

Note: The afterSign hook for macOS notarization will be added in Plan 02 after creating the entitlements and notarize script.
  </action>
  <verify>
- `cat electron-builder.yml | grep "appId"` shows "com.ancestree.app"
- `cat electron-builder.yml | grep "mac:"` shows macOS section exists
- `cat electron-builder.yml | grep "win:"` shows Windows section exists
- `cat electron-builder.yml | grep "linux:"` shows Linux section exists
- `cat package.json | grep '"pack"'` shows build scripts exist
  </verify>
  <done>electron-builder.yml exists with complete configuration for all platforms, package.json has pack:* scripts for building platform-specific installers</done>
</task>

</tasks>

<verification>
- [ ] assets/icon-source.png exists as 1024x1024 PNG
- [ ] build/icon.icns exists (macOS)
- [ ] build/icon.ico exists (Windows)
- [ ] build/icons/ contains all PNG sizes (16-512)
- [ ] electron-builder.yml is valid YAML with mac/win/linux sections
- [ ] package.json has icons and pack:* scripts
- [ ] `npm run build:electron` succeeds (pre-requisite for packaging)
</verification>

<success_criteria>
1. Icon files exist in all required formats for all platforms
2. electron-builder.yml configures DMG (macOS), NSIS (Windows), AppImage+deb (Linux)
3. Build scripts in package.json allow platform-specific packaging
4. Running `npm run pack:linux` on Linux produces a runnable AppImage (best test without macOS/Windows)
</success_criteria>

<output>
After completion, create `.planning/phases/04-packaging-branding/04-01-SUMMARY.md`
</output>
